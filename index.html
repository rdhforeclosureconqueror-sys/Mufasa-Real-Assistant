<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Prince of Pan-Africa ‚Äî Mufasa</title>
  <link rel="icon" href="data:,">
  <style>
    :root{--bg:#050505;--gold:#d4af37;--text:#f2f2f2;--muted:#bdbdbd;--card:rgba(0,0,0,.28);--line:rgba(212,175,55,.35)}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);
      background:radial-gradient(1100px 650px at 20% 10%, rgba(193,18,31,.16), transparent 55%),
               radial-gradient(1100px 650px at 80% 15%, rgba(27,127,58,.16), transparent 55%),
               radial-gradient(900px 550px at 50% 95%, rgba(212,175,55,.12), transparent 55%), var(--bg);}
    .wrap{max-width:1200px;margin:0 auto;padding:18px}
    .top{display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:space-between;padding:14px 16px;border:1px solid var(--line);
      border-radius:16px;background:rgba(0,0,0,.25)}
    .title{font-weight:900;letter-spacing:.4px}
    .sub{color:var(--muted);font-size:12px;margin-top:4px}
    .grid{display:grid;grid-template-columns:1.15fr .85fr;gap:14px;margin-top:14px}
    @media(max-width:980px){.grid{grid-template-columns:1fr}}
    .card{border:1px solid var(--line);border-radius:18px;background:rgba(0,0,0,.18);padding:14px}
    .hero{font-size:44px;line-height:1.02;margin:6px 0 10px}
    .hint{color:var(--muted);font-size:13px;line-height:1.35;margin:0 0 10px}
    .btn{appearance:none;border:1px solid rgba(212,175,55,.55);background:rgba(0,0,0,.22);color:var(--text);
      padding:10px 12px;border-radius:999px;cursor:pointer;font-weight:800;display:inline-flex;align-items:center;gap:8px}
    .btn:disabled{opacity:.55;cursor:not-allowed}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .chat{margin-top:12px;height:280px;overflow:auto;padding:12px;border-radius:14px;border:1px solid rgba(212,175,55,.25);background:rgba(0,0,0,.22)}
    .msg{margin:0 0 10px;padding:10px;border-radius:14px;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.04);white-space:pre-wrap;line-height:1.35}
    .msg.user{border-color:rgba(27,127,58,.35);background:rgba(27,127,58,.08)}
    .msg.ai{border-color:rgba(193,18,31,.35);background:rgba(193,18,31,.06)}
    .inputRow{margin-top:10px;display:flex;gap:10px}
    input{flex:1;padding:12px 14px;border-radius:999px;border:1px solid rgba(212,175,55,.45);background:rgba(0,0,0,.25);color:var(--text);outline:none}
    audio{width:100%;margin-top:10px}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:8px 10px;border-radius:999px;border:1px solid rgba(212,175,55,.25);
      background:rgba(0,0,0,.18);color:var(--muted);font-size:12px;margin-top:10px}
    .dot{width:10px;height:10px;border-radius:50%;background:#666}
    .dot.on{background:#1bd15d;box-shadow:0 0 10px rgba(27,209,93,.35)}
  </style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div>
      <div class="title">PRINCE OF PAN-AFRICA</div>
      <div class="sub">Black History ‚Ä¢ Year-Round ‚Ä¢ Powered by MufasaBrain</div>
    </div>
    <div class="row">
      <button class="btn" id="check">CHECK BRAIN</button>
      <a class="btn" href="swahili.html">SWAHILI</a>
      <a class="btn" href="yoruba.html">YORUBA</a>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="hero">Black History ‚Äî<br/>Every Month Is Black History.</div>
      <p class="hint">Ask anything: empires, revolutions, inventors, movements, leaders, migrations, and hidden histories.</p>

      <div class="row">
        <button class="btn" id="demo">Run a Demo Question</button>
        <button class="btn" id="clear">Clear Chat</button>
      </div>

      <div class="pill">
        <span class="dot" id="dot"></span>
        <span id="status">Brain: checking‚Ä¶</span>
      </div>

      <div class="chat" id="chat"></div>

      <div class="inputRow">
        <input id="q" type="text" placeholder='Type your question‚Ä¶ (e.g., "Explain the Mali Empire")' />
        <button class="btn" id="mic">üé§</button>
        <button class="btn" id="send">Send</button>
      </div>

      <div class="row" style="margin-top:10px">
        <button class="btn" id="read" disabled>üîä Read Answer</button>
        <button class="btn" id="makeSlides" disabled>üéûÔ∏è Create Slideshow</button>
        <button class="btn" id="openSlides" disabled>üìΩÔ∏è Open Slideshow</button>
      </div>

      <audio id="tts" controls></audio>
    </div>

    <div class="card">
      <div class="title" style="margin-bottom:10px">YEAR-ROUND LIBRARY</div>
      <div class="hint">Try: ‚ÄúCompare Mali and Songhai‚Äù ‚Ä¢ ‚ÄúGive me a Haitian Revolution timeline‚Äù ‚Ä¢ ‚ÄúTop 10 Black inventions‚Äù</div>
    </div>
  </div>
</div>

<script>
  // ‚úÖ SET THIS TO YOUR API WEB SERVICE URL
  const API_BASE = "https://mufasa-real-assistant-api.onrender.com";

  const ASK_URL = `${API_BASE}/ask`;
  const HEALTH_URL = `${API_BASE}/health`;
  const TTS_URL = `${API_BASE}/voice/tts`;
  const SB_GEN_URL = `${API_BASE}/storyboard/generate`;

  const chat = document.getElementById("chat");
  const q = document.getElementById("q");
  const tts = document.getElementById("tts");
  const dot = document.getElementById("dot");
  const status = document.getElementById("status");

  const btnSend = document.getElementById("send");
  const btnDemo = document.getElementById("demo");
  const btnClear = document.getElementById("clear");
  const btnCheck = document.getElementById("check");
  const btnRead = document.getElementById("read");
  const btnMakeSlides = document.getElementById("makeSlides");
  const btnOpenSlides = document.getElementById("openSlides");
  const btnMic = document.getElementById("mic");

  let lastAnswer = "";
  let lastStoryboardId = "";

  function addMsg(text, who){
    const div = document.createElement("div");
    div.className = `msg ${who}`;
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  async function checkBrain(){
    status.textContent = "Brain: checking‚Ä¶";
    dot.classList.remove("on");
    try{
      const r = await fetch(HEALTH_URL);
      if(!r.ok) throw new Error("health failed");
      const j = await r.json();
      dot.classList.add("on");
      status.textContent = `Brain online ‚Ä¢ model: ${j.openai_model || "unknown"}`;
    }catch(e){
      status.textContent = "Brain offline/sleeping ‚Ä¢ try again";
    }
  }

  async function ask(){
    const text = (q.value || "").trim();
    if(!text) return;

    addMsg(text, "user");
    btnSend.disabled = true;
    lastAnswer = "";
    lastStoryboardId = "";
    btnRead.disabled = true;
    btnMakeSlides.disabled = true;
    btnOpenSlides.disabled = true;

    try{
      const r = await fetch(ASK_URL, {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ question: text, user_id:"public_black_history_user", session_id:"web_session" })
      });
      if(!r.ok) throw new Error(await r.text());
      const j = await r.json();
      lastAnswer = (j.answer || "").trim();
      addMsg(lastAnswer || "(no answer returned)", "ai");

      btnRead.disabled = !lastAnswer;
      btnMakeSlides.disabled = !lastAnswer;
    }catch(e){
      addMsg("Error: " + (e.message || e), "ai");
    } finally {
      btnSend.disabled = false;
    }
  }

  async function readAnswer(){
    if(!lastAnswer) return;
    try{
      const form = new FormData();
      form.append("text", lastAnswer);
      const r = await fetch(TTS_URL, { method:"POST", body: form });
      if(!r.ok) throw new Error(await r.text());
      const blob = await r.blob();
      tts.src = URL.createObjectURL(blob);
      await tts.play();
    }catch(e){
      alert("TTS Error: " + (e.message || e));
    }
  }

  async function makeSlides(){
    if(!lastAnswer) return;
    btnMakeSlides.disabled = true;
    btnOpenSlides.disabled = true;

    try{
      const r = await fetch(SB_GEN_URL, {
        method:"POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
          text: lastAnswer,
          user_id: "public_black_history_user",
          max_slides: 8
        })
      });
      if(!r.ok) throw new Error(await r.text());
      const j = await r.json();
      lastStoryboardId = j?.data?.id || "";
      localStorage.setItem("lastStoryboardId", lastStoryboardId);
      localStorage.setItem("lastStoryboard", JSON.stringify(j));
      addMsg("‚úÖ Slideshow created. Tap ‚ÄúOpen Slideshow‚Äù.", "ai");
      btnOpenSlides.disabled = !lastStoryboardId;
    }catch(e){
      addMsg("Slideshow Error: " + (e.message || e), "ai");
    } finally {
      btnMakeSlides.disabled = !lastAnswer;
    }
  }

  function openSlides(){
    const id = lastStoryboardId || localStorage.getItem("lastStoryboardId") || "";
    if(!id) return alert("No slideshow yet. Create one first.");
    window.open(`web/slideshow.html?storyboard_id=${encodeURIComponent(id)}&api=${encodeURIComponent(API_BASE)}`, "_blank");
  }

  // üé§ Mic (Web Speech). If unsupported (iPhone Safari often), hide button.
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if(!SR){
    btnMic.style.display = "none";
  } else {
    const rec = new SR();
    rec.continuous = false;
    rec.interimResults = false;
    rec.lang = "en-US";
    btnMic.onclick = () => {
      try{
        rec.start();
        btnMic.textContent = "üéôÔ∏è‚Ä¶";
      }catch(e){}
    };
    rec.onresult = (evt) => {
      const text = evt.results?.[0]?.[0]?.transcript || "";
      q.value = text;
    };
    rec.onend = () => { btnMic.textContent = "üé§"; };
  }

  btnSend.onclick = ask;
  btnDemo.onclick = () => { q.value = "Give me a 3-part lesson on the Mali Empire: context, key figures, why it matters today."; ask(); };
  btnClear.onclick = () => {
    chat.innerHTML = "";
    lastAnswer = "";
    lastStoryboardId = "";
    btnRead.disabled = true;
    btnMakeSlides.disabled = true;
    btnOpenSlides.disabled = true;
    tts.removeAttribute("src"); tts.load();
  };
  btnRead.onclick = readAnswer;
  btnMakeSlides.onclick = makeSlides;
  btnOpenSlides.onclick = openSlides;
  btnCheck.onclick = checkBrain;

  q.addEventListener("keydown", (e) => { if(e.key === "Enter"){ e.preventDefault(); ask(); } });

  addMsg("Prince of Pan-Africa ready. Ask me a Black History question.", "ai");
  checkBrain();
</script>
</body>
</html>
