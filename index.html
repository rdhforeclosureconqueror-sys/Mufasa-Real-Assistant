<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mufasa Real Assistant ‚Äî Black History + Languages</title>

  <link rel="icon" href="data:,">

  <style>
    :root{
      --bg:#050505;
      --panel:#0c0c0c;
      --line:#d4af37; /* gold */
      --red:#c1121f;
      --green:#1b7f3a;
      --text:#f4f4f4;
      --muted:#bdbdbd;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 700px at 15% 5%, rgba(193,18,31,.18), transparent 55%),
        radial-gradient(1200px 700px at 85% 15%, rgba(27,127,58,.18), transparent 55%),
        radial-gradient(1000px 600px at 50% 95%, rgba(212,175,55,.10), transparent 55%),
        var(--bg);
      color: var(--text);
    }

    .wrap{ max-width:1100px; margin:0 auto; padding:18px; }
    .topbar{
      display:flex; gap:14px; align-items:center; justify-content:space-between;
      padding:14px 16px;
      background: linear-gradient(180deg, rgba(12,12,12,.92), rgba(12,12,12,.68));
      border: 1px solid rgba(212,175,55,.55);
      border-radius:14px;
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
    }
    .brand{
      display:flex; flex-direction:column; gap:2px;
    }
    .brand h1{
      margin:0;
      font-size:18px;
      letter-spacing:.6px;
    }
    .brand .sub{
      font-size:12px;
      color: var(--muted);
    }

    .nav{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
    }

    .btn{
      appearance:none;
      border: 1px solid rgba(212,175,55,.65);
      background: rgba(0,0,0,.25);
      color: var(--text);
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:600;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
      user-select:none;
    }
    .btn:hover{
      transform: translateY(-1px);
      background: rgba(212,175,55,.10);
      border-color: rgba(212,175,55,.95);
    }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
    }
    .btn.red{ border-color: rgba(193,18,31,.75); }
    .btn.red:hover{ background: rgba(193,18,31,.12); border-color: rgba(193,18,31,.95); }
    .btn.green{ border-color: rgba(27,127,58,.75); }
    .btn.green:hover{ background: rgba(27,127,58,.12); border-color: rgba(27,127,58,.95); }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:14px;
      margin-top:14px;
    }
    @media (max-width: 920px){
      .grid{ grid-template-columns:1fr; }
      .nav{ justify-content:flex-start; }
    }

    .card{
      background: linear-gradient(180deg, rgba(12,12,12,.9), rgba(12,12,12,.65));
      border: 1px solid rgba(212,175,55,.45);
      border-radius:14px;
      padding:14px;
      box-shadow: 0 18px 55px rgba(0,0,0,.35);
    }
    .card h2{
      margin:0 0 10px 0;
      font-size:15px;
      letter-spacing:.4px;
    }
    .hint{
      margin:0 0 10px 0;
      color: var(--muted);
      font-size:12.5px;
      line-height:1.35;
    }

    .chatBox{
      height: 360px;
      overflow:auto;
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(212,175,55,.35);
      background: rgba(0,0,0,.22);
    }
    .msg{
      margin:0 0 10px 0;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.08);
      background: rgba(255,255,255,.04);
      white-space:pre-wrap;
      line-height:1.35;
    }
    .msg.user{
      border-color: rgba(27,127,58,.35);
      background: rgba(27,127,58,.08);
    }
    .msg.ai{
      border-color: rgba(193,18,31,.35);
      background: rgba(193,18,31,.06);
    }
    .row{
      display:flex; gap:10px; margin-top:10px; flex-wrap:wrap;
    }
    textarea{
      width:100%;
      min-height:74px;
      resize:vertical;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid rgba(212,175,55,.45);
      background: rgba(0,0,0,.25);
      color: var(--text);
      outline:none;
    }
    textarea:focus{
      border-color: rgba(212,175,55,.95);
      box-shadow: 0 0 0 4px rgba(212,175,55,.12);
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(212,175,55,.35);
      background: rgba(0,0,0,.18);
      color: var(--muted);
      font-size:12px;
      margin-top:10px;
    }

    audio{ width:100%; margin-top:10px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <h1>ü¶Å Mufasa Real Assistant</h1>
        <div class="sub">Black History ‚Ä¢ Swahili ‚Ä¢ Yoruba ‚Ä¢ (AI voice enabled)</div>
      </div>

      <div class="nav">
        <a class="btn green" href="swahili.html">üó£Ô∏è Swahili: Lesson of the Day</a>
        <a class="btn green" href="yoruba.html">üó£Ô∏è Yoruba: Lesson of the Day</a>
        <a class="btn" href="about.html">‚ÑπÔ∏è About</a>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: Chat -->
      <div class="card">
        <h2>üìö Black History Chat</h2>
        <p class="hint">
          Ask anything about Black history. You can type. The assistant can <b>read answers out loud</b>.
          (Mic input is disabled for now ‚Äî we‚Äôll bring it back when you ship the app.)
        </p>

        <div id="chatBox" class="chatBox"></div>

        <textarea id="question" placeholder="Type your question here..."></textarea>

        <div class="row">
          <button class="btn red" id="btnAsk">Ask Mufasa</button>
          <button class="btn" id="btnRead" disabled>üîä Read Answer</button>
          <button class="btn" id="btnClear">üßπ Clear</button>
        </div>

        <div class="pill">üîí Download locked (membership + signed link later)</div>

        <audio id="ttsAudio" controls></audio>
      </div>

      <!-- RIGHT: Quick Links / Features -->
      <div class="card">
        <h2>‚ú® What‚Äôs Live Right Now</h2>
        <p class="hint">
          Phase 1 is focused on content + chat + language learning. Android phone-control comes in Phase 2.
        </p>

        <div class="row">
          <a class="btn green" href="swahili.html">Open Swahili</a>
          <a class="btn green" href="yoruba.html">Open Yoruba</a>
        </div>

        <div style="margin-top:12px;">
          <div class="msg ai">
            <b>Current Capabilities:</b><br>
            ‚Ä¢ Black History Q&A (text chat)<br>
            ‚Ä¢ AI reads answers (TTS button)<br>
            ‚Ä¢ Swahili daily lessons<br>
            ‚Ä¢ Yoruba daily lessons<br>
          </div>

          <div class="msg user">
            <b>Coming Next:</b><br>
            ‚Ä¢ Login (Google)<br>
            ‚Ä¢ Membership gates + Black Dollar ledger<br>
            ‚Ä¢ Android Phone Assistant (app + accessibility/adb bridge)
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ‚úÖ CHANGE THIS to your Ma‚Äôat brain base URL
    const MAAT_BASE_URL = "https://mufasabrain.onrender.com";

    const ASK_URL = `${MAAT_BASE_URL}/ask`;
    const TTS_URL = `${MAAT_BASE_URL}/voice/tts`;

    const chatBox = document.getElementById("chatBox");
    const questionEl = document.getElementById("question");
    const btnAsk = document.getElementById("btnAsk");
    const btnRead = document.getElementById("btnRead");
    const btnClear = document.getElementById("btnClear");
    const ttsAudio = document.getElementById("ttsAudio");

    let lastAnswerText = "";

    function addMsg(text, who){
      const div = document.createElement("div");
      div.className = `msg ${who}`;
      div.textContent = text;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    async function askMufasa(){
      const q = (questionEl.value || "").trim();
      if(!q) return;

      addMsg(q, "user");
      questionEl.value = "";

      btnAsk.disabled = true;
      btnRead.disabled = true;

      try{
        const payload = {
          question: q,
          user_id: "rashad",
          session_id: "web_session",
          mode: "chat"
        };

        const r = await fetch(ASK_URL, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify(payload)
        });

        if(!r.ok){
          const t = await r.text();
          throw new Error(t || "Ask failed");
        }

        const rec = await r.json();
        const answer = rec.answer || rec.response || "(no answer returned)";

        lastAnswerText = answer;
        addMsg(answer, "ai");

        btnRead.disabled = !lastAnswerText.trim();
      }catch(err){
        console.error(err);
        addMsg("Error: " + (err?.message || err), "ai");
      }finally{
        btnAsk.disabled = false;
      }
    }

    async function readAnswer(){
      if(!lastAnswerText.trim()) return;

      btnRead.disabled = true;

      try{
        // TTS expects form field "text"
        const form = new FormData();
        form.append("text", lastAnswerText);

        const r = await fetch(TTS_URL, { method:"POST", body: form });
        if(!r.ok){
          const t = await r.text();
          throw new Error(t || "TTS failed");
        }

        const audioBlob = await r.blob();
        const url = URL.createObjectURL(audioBlob);
        ttsAudio.src = url;

        // iOS: play() must be triggered by click. This is a click, so it should work.
        await ttsAudio.play();
      }catch(err){
        console.error(err);
        alert("TTS Error: " + (err?.message || err));
      }finally{
        btnRead.disabled = !lastAnswerText.trim();
      }
    }

    btnAsk.addEventListener("click", askMufasa);
    btnRead.addEventListener("click", readAnswer);
    btnClear.addEventListener("click", () => {
      chatBox.innerHTML = "";
      lastAnswerText = "";
      btnRead.disabled = true;
      ttsAudio.removeAttribute("src");
      ttsAudio.load();
    });

    questionEl.addEventListener("keydown", (e) => {
      if(e.key === "Enter" && (e.ctrlKey || e.metaKey)){
        askMufasa();
      }
    });

    // Welcome message
    addMsg("Welcome. Ask a Black History question. Then tap üîä Read Answer to hear Mufasa speak.", "ai");
  </script>
</body>
</html>
