<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ü¶Å Mufasa Real Assistant | Pan-African Portal</title>
  <link rel="stylesheet" href="portal.css" />
  <style>
    /* =====================================================
       üåç FUTURISTIC PAN-AFRICAN STYLE
    ===================================================== */
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@600&family=Poppins:wght@400;600&display=swap');

    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at center, #000 30%, #001a00 100%);
      color: #f5f5f5;
      overflow: hidden;
    }

    #intro-screen {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      transition: opacity 1s ease;
    }
    #intro-screen.fade-out { opacity: 0; visibility: hidden; }
    #intro-video {
      position: absolute;
      width: 100%; height: 100%;
      object-fit: cover;
      filter: brightness(0.6) contrast(1.2);
    }
    .intro-title {
      position: relative;
      z-index: 2;
      font-family: 'Cinzel', serif;
      font-size: 3rem;
      color: #00ff99;
      text-shadow: 0 0 20px rgba(0,255,150,0.7);
    }

    /* =====================================================
       üß† MAIN APP LAYOUT
    ===================================================== */
    #app.hidden { display: none; }
    #app {
      display: flex;
      flex-direction: column;
      height: 100vh;
      padding: 0;
    }

    header {
      background: rgba(0, 30, 0, 0.7);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 0 15px rgba(0,255,100,0.1);
      border-bottom: 1px solid rgba(0,255,150,0.2);
    }

    .brand-title {
      font-family: 'Cinzel', serif;
      color: #00ff99;
      font-size: 1.5rem;
    }

    nav select {
      background: rgba(0,0,0,0.7);
      border: 1px solid #00cc66;
      color: #00ffcc;
      border-radius: 8px;
      padding: 5px 10px;
    }

    main {
      display: flex;
      flex: 1;
      overflow: hidden;
      background: linear-gradient(145deg, #000 40%, #002200 100%);
    }

    #chat-section {
      flex: 2;
      display: flex;
      flex-direction: column;
      margin: 1rem;
    }

    #chat-window {
      flex: 1;
      padding: 1rem;
      border-radius: 15px;
      background: rgba(0, 40, 0, 0.6);
      box-shadow: 0 0 15px rgba(0,255,100,0.05);
      overflow-y: auto;
      scroll-behavior: smooth;
    }

    .message.user {
      text-align: right;
      color: #fff;
      margin: 8px 0;
    }
    .message.bot {
      text-align: left;
      color: #aaffcc;
      margin: 8px 0;
    }

    #chat-controls {
      margin-top: 0.5rem;
      display: flex;
      flex-direction: column;
    }

    #user-input {
      background: rgba(0,0,0,0.8);
      border: 1px solid #00cc66;
      border-radius: 10px;
      color: #fff;
      padding: 10px;
      resize: none;
      font-size: 1rem;
      height: 70px;
    }

    #chat-buttons {
      display: flex;
      gap: 10px;
      margin-top: 0.5rem;
    }

    .action-btn {
      flex: 1;
      background: linear-gradient(90deg, #004400, #00cc66);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 10px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .action-btn:hover {
      box-shadow: 0 0 15px #00ff88;
      transform: scale(1.05);
    }

    /* SIDE PANEL */
    #side-panel {
      flex: 1;
      background: rgba(0, 20, 0, 0.7);
      padding: 1rem;
      border-left: 1px solid rgba(0,255,150,0.2);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .panel-block {
      background: rgba(0,50,0,0.3);
      padding: 0.7rem;
      border-radius: 10px;
      box-shadow: inset 0 0 8px rgba(0,255,100,0.05);
      margin-bottom: 1rem;
    }

    .progress-bar {
      height: 10px;
      background: #003300;
      border-radius: 5px;
      overflow: hidden;
    }
    #progress-fill {
      width: 5%;
      height: 100%;
      background: #00ff99;
      transition: width 0.5s ease;
    }

    footer {
      text-align: center;
      padding: 0.5rem;
      background: rgba(0, 30, 0, 0.9);
      font-size: 0.8rem;
      color: #aaffcc;
    }
  </style>
</head>

<body>
  <!-- ü¶Å INTRO VIDEO -->
  <div id="intro-screen">
    <video autoplay muted id="intro-video">
      <source src="assets/fire-lion.mp4" type="video/mp4" />
    </video>
    <h1 class="intro-title">PAN AFRICA UNITE</h1>
  </div>

  <!-- üåç MAIN APP -->
  <div id="app" class="hidden">
    <header>
      <h1 class="brand-title">ü¶Å Mufasa Real Assistant</h1>

      <nav>
        <select id="portal-selector">
          <option value="">Select a Portal</option>
          <option value="MAAT30">Order of Ma‚Äôat</option>
          <option value="DECLO30">Decolonize the Mind</option>
          <option value="MEL30">Melanin: The Superpower</option>
          <option value="MEGA30">Black Megacities After Slavery</option>
          <option value="BWOM30">The Black Woman</option>
          <option value="CIV30">Africans Built Civilization</option>
          <option value="LAB30">Ancestral Science Lab</option>
          <option value="PYR30">Pyramid Portal</option>
          <option value="SCA30">Scalar Waves</option>
          <option value="BCF30">Book of Coming Forth by Day</option>
          <option value="ROP30">Rites of Passage</option>
        </select>
      </nav>
    </header>

    <!-- ‚ö° CHAT + PANELS -->
    <main>
      <section id="chat-section">
        <div id="chat-window"></div>
        <div id="chat-controls">
          <textarea id="user-input" placeholder="Type or speak to Mufasa..."></textarea>
          <div id="chat-buttons">
            <button id="mic-btn" class="action-btn">üé§ Mic</button>
            <button id="send-btn" class="action-btn">üí¨ Send</button>
            <button id="mufasa-speak-btn" class="action-btn">ü¶Å Speak</button>
          </div>
        </div>
      </section>

      <aside id="side-panel">
        <div class="panel-block">
          <h3>üìÖ Calendar</h3>
          <div id="calendar"></div>
        </div>
        <div class="panel-block">
          <h3>üß≠ Progress</h3>
          <p id="progress-text">Day 1 of 30</p>
          <div class="progress-bar"><div id="progress-fill"></div></div>
        </div>
        <div class="panel-block">
          <h3>üìù Journal</h3>
          <textarea id="journal-input" placeholder="Reflect and write your thoughts here..."></textarea>
          <button id="save-journal-btn" class="action-btn">üíæ Save</button>
        </div>
      </aside>
    </main>

    <footer>
      <p>¬© 2025 Mufasa Real Assistant | Pan-African Knowledge Network</p>
    </footer>
  </div>

  <!-- üß† CORE SCRIPT -->
  <script>
    const API_BASE = "https://mufasa-real-assistant-api.onrender.com";

    window.addEventListener("load", () => {
      const intro = document.getElementById("intro-screen");
      const video = document.getElementById("intro-video");
      const app = document.getElementById("app");

      function showApp() {
        intro.classList.add("fade-out");
        setTimeout(() => {
          intro.style.display = "none";
          app.classList.remove("hidden");
        }, 1200);
      }

      setTimeout(showApp, 6000);
      video.addEventListener("ended", showApp);
    });

    const chatWindow = document.getElementById("chat-window");
    const userInput = document.getElementById("user-input");
    const sendBtn = document.getElementById("send-btn");
    const micBtn = document.getElementById("mic-btn");
    const mufasaSpeakBtn = document.getElementById("mufasa-speak-btn");

    // Add message to chat
    function addMessage(sender, text) {
      const div = document.createElement("div");
      div.className = "message " + (sender === "You" ? "user" : "bot");
      div.textContent = `${sender}: ${text}`;
      chatWindow.appendChild(div);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    // AI CHAT
    sendBtn.addEventListener("click", async () => {
      const message = userInput.value.trim();
      if (!message) return;
      addMessage("You", message);
      userInput.value = "";

      const res = await fetch(`${API_BASE}/api/chat`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message }),
      });

      const data = await res.json();
      const reply = data.reply || "Mufasa is silent...";
      addMessage("Mufasa", reply);
      speakText(reply);
      lastReply = reply;
    });

    // üéôÔ∏è Speech-to-Text
    let recognition;
    if ("webkitSpeechRecognition" in window) {
      recognition = new webkitSpeechRecognition();
      recognition.lang = "en-US";
      recognition.continuous = false;
      recognition.interimResults = false;
      micBtn.addEventListener("click", () => recognition.start());
      recognition.onresult = (e) => {
        userInput.value = e.results[0][0].transcript;
      };
    }

    // üîä Text-to-Speech
    const synth = window.speechSynthesis;
    let lastReply = "";
    function speakText(text) {
      if (!text) return;
      const utter = new SpeechSynthesisUtterance(text);
      utter.voice = synth.getVoices().find(v => v.name.includes("Male")) || null;
      utter.rate = 1;
      utter.pitch = 1;
      synth.cancel();
      synth.speak(utter);
    }

    mufasaSpeakBtn.addEventListener("click", () => {
      if (lastReply) speakText(lastReply);
    });
  </script>
</body>
</html>
